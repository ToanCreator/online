<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ToÃ n Creator - Online Lesson</title>
<style>
  :root {
    --yellow: #f9d342;
    --yellow-dark: #d4b833;
    --Green: #2ecc71;
    --starsGreen: #2ecc71;
    --red: #d93025;
    --green: #2ecc40;
    --starsGray: #ccc;
    --star-size: 30px;
    --orange: #ff9800;
  }
  body {
    margin:0; padding:0; font-family: Arial, sans-serif;
    background: white; color: black;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark {
    background: black; color: white;
  }
  /* Existing #app rule */
#app {
  max-width: 600px;
  margin: 0 auto;
  padding: 15px;
}

/* Media query for larger screens (e.g., tablets and desktops) */
@media (min-width: 768px) {
  #app {
    max-width: 960px; /* Or any wider value you prefer, e.g., 900px, 1200px */
    padding: 20px; /* Optional: Increase padding for more space on larger screens */
  }

  /* Optional: Adjust button widths for larger screens if they look too wide */
  .btn {
    max-width: 400px; /* Make main buttons a bit wider */
  }

  /* Optional: Adjust status bar layout for larger screens */
  .status-bar {
    font-size: 1.1em;
  }
}
  h1, h3 {
    text-align: center;
    margin: 10px 0;
  }
  h2 {
    text-align: center;
    margin: 10px 0;
    color: #FF00FF;
  }
  hr {
    border:none; border-bottom: 3px solid black;
    margin: 5px 0 25px 0;
  }
  .btn {
    background: #3399FF;
    border-radius: 8px;
    border:none;
    color: white;
    font-weight: bold;
    font-size: 1.2em;
    padding: 15px;
    width: 100%;
    max-width: 350px;
    margin: 10px auto;
    cursor: pointer;
    display: block;
    box-sizing: border-box;
    text-align: center;
    border: 3px solid transparent;
    user-select: none;
  }
  .btn:hover {
    background: var(--yellow-dark);
  }
  .btn svg {
    vertical-align: middle;
  }
  .question-container {
    margin-bottom: 20px;
    color: var(--orange) !important;
    font-weight: bold;
    font-size: 1.08em;
    transition: color 0.3s;
  }
  body.dark .question-container {
    color: var(--orange) !important;
  }
  .answers {
    margin-top: 15px;
  }
  .answer-btn {
    display: block;
    width: 100%;
    border: 2px solid black;
    border-radius: 6px;
    background-color: white;
    color: black;
    font-size: 1em;
    padding: 12px 10px;
    margin: 7px 0;
    cursor: pointer;
    text-align: left;
    user-select: none;
    transition: background-color 0.3s, border-color 0.3s, color 0.3s;
  }
  .answer-btn:hover:not(.disabled) {
    background-color: #eee;
  }
  body.dark .answer-btn {
    background-color: #222;
    color: white;
    border-color: white;
  }
  body.dark .answer-btn:hover:not(.disabled) {
    background-color: #444;
  }
  .answer-btn.correct {
    background-color: var(--green) !important;
    color: white !important;
    border-color: var(--green) !important;
  }
  .answer-btn.incorrect {
    background-color: var(--red) !important;
    color: white !important;
    border-color: var(--red) !important;
  }
  body.dark .answer-btn.correct {
    background-color: var(--green) !important;
    color: white !important;
    border-color: var(--green) !important;
  }
  body.dark .answer-btn.incorrect {
    background-color: var(--red) !important;
    color: white !important;
    border-color: var(--red) !important;
  }
  .disabled {
    pointer-events: none;
  }
  .status-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-weight: bold;
  }
  .star-container {
    text-align: center;
    margin: 20px 0 10px 0;
  }
  .star {
    font-size: var(--star-size);
    margin: 0 5px;
    color: var(--starsGray);
  }
  .star.Green {
    color: var(--Green);
  }
  .star.red {
    color: var(--red);
  }
  .toggle-btn {
    background: lime;
    color: white;
    font-size: 1.5em;
    padding: 12px 0;
    margin: 25px auto;
    width: 150px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    display: block;
  }
  .input-textarea {
    width: 100%;
    min-height: 80px;
    font-size: 1em;
    padding: 10px;
    border-radius: 6px;
    border: 2px solid black;
    resize: vertical;
    box-sizing: border-box;
  }
  body.dark .input-textarea {
    background-color: #222;
    color: white;
    border-color: white;
  }
  .btn-small {
    background: #FF99CC;
    width: auto;
    padding: 8px 15px;
    font-size: 1em;
    margin-top: 10px;
  }
  .answer-btn img {
    max-width: 100%;
    max-height: 150px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 3px;
  }
  .question-container img {
    max-width: 100%;
    max-height: 300px;
    margin: 15px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  body.dark .answer-btn img,
  body.dark .question-container img {
    border-color: #555;
  }
  .question-container img, .answer-btn img {
    display: block;
    margin: 0 auto;
    background: #f5f5f5;
  }
  body.dark .question-container img,
  body.dark .answer-btn img {
    background: #333;
  }
  /* Style for the header image placeholder */
  .header-image-placeholder {
    display: block;
    width: 100%; /* Hoáº·c má»™t chiá»u rá»™ng cá»‘ Ä‘á»‹nh */
    height: 100px; /* Äiá»u chá»‰nh chiá»u cao nÃ y Ä‘á»ƒ phÃ¹ há»£p vá»›i kÃ­ch thÆ°á»›c báº¡n muá»‘n */
    background-color: #f0f0f0; /* MÃ u ná»n Ä‘á»ƒ dá»… nhÃ¬n tháº¥y placeholder */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.5em;
    color: #666;
    margin-bottom: 25px; /* Khoáº£ng cÃ¡ch vá»›i tiÃªu Ä‘á» bÃªn dÆ°á»›i */
    
  }
  body.dark .header-image-placeholder {
    background-color: #333;
    color: #bbb;
  }
</style>
</head>
<body>
<div id="app">
  <img src="https://i.ibb.co/tMdHNdPH/Picsart-25-07-17-06-40-25-073.jpg" alt="Header Image" class="header-image-placeholder">
  
  <h2>TOÃN - BÃ€I 1</h2>

  <button class="btn" id="btn-exit" style="background: var(--red);">
    <svg width="24" height="24" fill="white" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:5px;">
      <path d="M16 17v-4h-2V7h-4V4H6V2H4v2h2v4h4v6h2v4h4v2h2v-2h-2z"/>
    </svg>
    ThoÃ¡t
  </button>
  <button class="btn" id="btn-multi">TRáº®C NGHIá»†M 4 PHÆ¯Æ NG ÃN</button>
  <button class="btn" id="btn-truefalse">TRáº®C NGHIá»†M ÄÃšNG/SAI</button>
  <button class="btn" id="btn-essay">Tá»° LUáº¬N</button>

  <button class="toggle-btn" id="toggle-theme">ğŸ’¡</button>
  <button class="toggle-btn" id="btn-download" style="background: orange; margin-top: -20px; margin-bottom: 25px;">
    Táº£i xuá»‘ng
  </button>
  <div id="quiz-section" style="display:none; margin-top: 10px;">
    <div class="status-bar">
      <div>Thá»i gian:<span id="timer">00:00</span></div>
      <div>CÃ¢u Ä‘Ã£ lÃ m:<span id="done-count">0</span></div>
      <div>ÄÃºng:<span id="correct-count">0</span> | <strong>Sai:</strong><span id="wrong-count">0</span></div>
    </div>

    <div id="question-block" class="question-container"></div>
    <div id="answers-block" class="answers"></div>

    <div id="essay-input-block" style="display:none;">
      <textarea id="essay-answer" class="input-textarea" placeholder="Nháº­p cÃ¢u tráº£ lá»i cá»§a báº¡n..."></textarea>
      <button id="btn-essay-submit" class="btn-small">Xong</button>
    </div>

    <div style="display:flex; justify-content: space-between; margin-top: 20px;">
      <button id="btn-back-home-in-quiz" class="btn btn-small" style="background: var(--Green); width: 48%;">
        <svg width="24" height="24" fill="white" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:5px;">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
      </button>
      <button id="btn-next" class="btn btn-small" style="width: 48%;">Tiáº¿p tá»¥c</button>
    </div>
  </div>

  <div id="result-section" style="display:none; text-align:center; margin-top: 30px;">
    <h2>Káº¾T THÃšC BÃ€I LÃ€M</h2>
    <div><strong>Tá»•ng thá»i gian lÃ m bÃ i:</strong> <span id="result-time"></span></div>
    <div><strong>Tá»•ng sá»‘ cÃ¢u Ä‘Ã£ lÃ m:</strong> <span id="result-total"></span></div>
    <div><strong>ÄÃºng:</strong><span id="result-correct"></span><strong> | </strong><strong>Sai:</strong><span id="result-wrong"></span></div>
    <div id="star-rating" class="star-container"></div>
    <div style="margin-top: 25px;">
      <button id="btn-home" class="btn" style="display:inline-block; width:120px;">
        <svg width="24" height="24" fill="white" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:5px;">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg> 
      </button>
      </div>
  </div>
</div>

<script>
(() => {
  // --- QUESTION DATA ---
  // Multiple choice questions [ABCD]
  const multiChoiceQuestions = [
    {
      q: "Cho hÃ m sá»‘ f(x) cÃ³ báº£ng xÃ©t dáº¥u cá»§a Ä‘áº¡o hÃ m nhÆ° sau, hÃ m sá»‘ Ä‘Ã£ cho Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o dÆ°á»›i Ä‘Ã¢y?",
      qImage: "https://i.ibb.co/GQt19Dyw/image.png",
      answers: [
        { text: "(-âˆ; -2)", correct: false, image: null },
        { text: "(-2; 1)", correct: true, image: null },
        { text: "(1; +âˆ)", correct: false, image: null },
        { text: "(-âˆ; 1)", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = f(x) cÃ³ báº£ng biáº¿n thiÃªn nhÆ° sau, hÃ m sá»‘ Ä‘Ã£ cho nghá»‹ch biáº¿n trÃªn khoáº£ng nÃ o dÆ°á»›i Ä‘Ã¢y?",
      qImage: "https://i.ibb.co/k6wypRqc/image.png",
      answers: [
        { text: "(-3; -1)", correct: false, image: null },
        { text: "(-âˆ; 0)", correct: false, image: null },
        { text: "(-2; -1)", correct: true, image: null },
        { text: "(-3; -2)âˆª (-2; -1)", correct: false, image: null }
      ]
    },
    {
      q: "Cho báº£ng biáº¿n thiÃªn nhÆ° hÃ¬nh váº½ bÃªn. Há»i Ä‘Ã¢y lÃ  báº£ng biáº¿n thiÃªn cá»§a hÃ m sá»‘ nÃ o trong cÃ¡c hÃ m sá»‘ sau?",
      qImage: "https://i.ibb.co/Wv4sb2zf/image.png",
      answers: [
        { text: "y = (-x+2)/(x-1)", correct: false, image: null },
        { text: "y = (x+2)/(x-1)", correct: true, image: null },
        { text: "y = (x+2)/(x+1)", correct: false, image: null },
        { text: "y = (x-3)/(x-1)", correct: false, image: null }
      ]
    },
    {
      q: "ÄÆ°á»ng cong á»Ÿ hÃ¬nh bÃªn lÃ  Ä‘á»“ thá»‹ cá»§a hÃ m sá»‘ y = (ax+b)/(cx+d) vá»›i a,b,c,d lÃ  cÃ¡c sá»‘ thá»±c. Má»‡nh Ä‘á» nÃ o dÆ°á»›i Ä‘Ã¢y Ä‘Ãºng?",
      qImage: "https://i.ibb.co/FbPFMkkW/image.png",
      answers: [
        { text: "y' < 0, âˆ€xâ‰ 1", correct: true, image: null },
        { text: "y' > 0, âˆ€xâˆˆR", correct: false, image: null },
        { text: "y' < 0, âˆ€xâˆˆR", correct: false, image: null },
        { text: "y' > 0, âˆ€xâ‰ 1", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ f(x) cÃ³ Ä‘áº¡o hÃ m trÃªn R lÃ  hÃ m sá»‘ f'(x) cÃ³ Ä‘á»“ thá»‹ nhÆ° hÃ¬nh váº½. HÃ m sá»‘ f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng nÃ o?",
      qImage: "https://i.ibb.co/n831HY61/image.png",
      answers: [
        { text: "(-âˆ; 0)", correct: true, image: null },
        { text: "(0; 1)", correct: false, image: null },
        { text: "(1; +âˆ)", correct: false, image: null },
        { text: "(-1/3; 1)", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = xÂ³ - 3xÂ² + 5. Má»‡nh Ä‘á» nÃ o dÆ°á»›i Ä‘Ã¢y Ä‘Ãºng?",
      qImage: null,
      answers: [
        { text: "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn khoáº£ng (-âˆ; 0)", correct: false, image: null },
        { text: "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn khoáº£ng (0; 2)", correct: true, image: null },
        { text: "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn khoáº£ng (2; +âˆ)", correct: false, image: null },
        { text: "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn khoáº£ng (0; 2)", correct: false, image: null }
      ]
    },
    {
      q: "Trong cÃ¡c hÃ m sá»‘ sau, hÃ m sá»‘ nÃ o Ä‘á»“ng biáº¿n trÃªn R?",
      qImage: null,
      answers: [
        { text: "y = tan(x)", correct: false, image: null },
        { text: "y = xâ´ + xÂ² + 1", correct: false, image: null },
        { text: "y = xÂ³ + 1", correct: true, image: null },
        { text: "y = (4x+1)/(x+2)", correct: false, image: null }
      ]
    },
    {
      q: "HÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m y' = xÂ²(x-5). Má»‡nh Ä‘á» nÃ o sau Ä‘Ã¢y Ä‘Ãºng?",
      qImage: null,
      answers: [
        { text: "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn (5; +âˆ)", correct: true, image: null },
        { text: "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn (5; +âˆ)", correct: false, image: null },
        { text: "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn R", correct: false, image: null },
        { text: "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn (-âˆ; 0) vÃ  (5; +âˆ)", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = xÂ² - 2x, âˆ€xâˆˆR. HÃ m sá»‘ y = -2f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o?",
      qImage: null,
      answers: [
        { text: "(0; 2)", correct: true, image: null },
        { text: "(2; +âˆ)", correct: false, image: null },
        { text: "(-âˆ; -2)", correct: false, image: null },
        { text: "(-2; 0)", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = (x+1)Â²(x-1)Â³(2-x). HÃ m sá»‘ f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o, trong cÃ¡c khoáº£ng dÆ°á»›i Ä‘Ã¢y?",
      qImage: null,
      answers: [
        { text: "(-1; 1)", correct: false, image: null },
        { text: "(1; 2)", correct: true, image: null },
        { text: "(-âˆ; -1)", correct: false, image: null },
        { text: "(2; +âˆ)", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = (3-x)(xÂ²-1) + 2x, âˆ€xâˆˆR. Há»i hÃ m sá»‘ g(x) = f(x) - xÂ² - 1 Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o trong cÃ¡c khoáº£ng dÆ°á»›i Ä‘Ã¢y?",
      qImage: null,
      answers: [
        { text: "(3; +âˆ)", correct: false, image: null },
        { text: "(-âˆ; 1)", correct: false, image: null },
        { text: "(1; 2)", correct: true, image: null },
        { text: "(-1; 0)", correct: false, image: null }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = f(x) liÃªn tá»¥c trÃªn R vÃ  cÃ³ Ä‘áº¡o hÃ m f'(x) = (x+1)Â²(x-1)Â³(2-x). HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o dÆ°á»›i Ä‘Ã¢y?",
      qImage: null,
      answers: [
        { text: "(1; 2)", correct: true, image: null },
        { text: "(-âˆ; -1)", correct: false, image: null },
        { text: "(-1; 1)", correct: false, image: null },
        { text: "(2; +âˆ)", correct: false, image: null }
      ]
    },
	{
      "q": "HÃ m sá»‘ y = -xÂ³ + 3xÂ² - 1 nghá»‹ch biáº¿n trÃªn khoáº£ng nÃ o dÆ°á»›i Ä‘Ã¢y?",
      "answers": [
        { "text": "[0; 2]", "correct": false },
        { "text": "(-âˆ; 0]", "correct": true },
        { "text": "(1; +âˆ)", "correct": false },
        { "text": "(-1; 1)", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = xâ´ - 2xÂ² - 3 Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o dÆ°á»›i Ä‘Ã¢y?",
      "answers": [
        { "text": "(-1; 0)", "correct": true },
        { "text": "(-âˆ; -1)", "correct": false },
        { "text": "(0; 1)", "correct": false },
        { "text": "(-1; 1)", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y = (2x+1)/(x-1). Má»‡nh Ä‘á» nÃ o sau Ä‘Ã¢y lÃ  Ä‘Ãºng?",
      "answers": [
        { "text": "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn R \\ {1}", "correct": false },
        { "text": "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn cÃ¡c khoáº£ng (-âˆ; 1) vÃ  (1; +âˆ)", "correct": true },
        { "text": "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn cÃ¡c khoáº£ng (-âˆ; 1) vÃ  (1; +âˆ)", "correct": false },
        { "text": "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn R", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ nÃ o sau Ä‘Ã¢y nghá»‹ch biáº¿n trÃªn R?",
      "answers": [
        { "text": "y = -xÂ³ + xÂ² - x + 1", "correct": true },
        { "text": "y = xÂ³ + 3", "correct": false },
        { "text": "y = -xâ´ - 2xÂ²", "correct": false },
        { "text": "y = (x+1)/(x-2)", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = x(x-1)Â²(x-2). HÃ m sá»‘ f(x) cÃ³ bao nhiÃªu Ä‘iá»ƒm cá»±c trá»‹?",
      "answers": [
        { "text": "0", "correct": false },
        { "text": "1", "correct": false },
        { "text": "2", "correct": true },
        { "text": "3", "correct": false }
      ]
    },
    {
      "q": "Khoáº£ng Ä‘á»“ng biáº¿n cá»§a hÃ m sá»‘ y = -xâ´ + 8xÂ² - 1 lÃ :",
      "answers": [
        { "text": "(-âˆ; -2) vÃ  (0; 2)", "correct": true },
        { "text": "(-2; 0) vÃ  (2; +âˆ)", "correct": false },
        { "text": "(-âˆ; -2) vÃ  (2; +âˆ)", "correct": false },
        { "text": "(-2; 2)", "correct": false }
      ]
    },
    {
      "q": "TÃ¬m táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ thá»±c cá»§a tham sá»‘ m Ä‘á»ƒ hÃ m sá»‘ y = xÂ³ - 3xÂ² + mx + 2 Ä‘á»“ng biáº¿n trÃªn khoáº£ng (1; +âˆ).",
      "answers": [
        { "text": "m â‰¥ 3", "correct": true },
        { "text": "m â‰¤ 3", "correct": false },
        { "text": "m = 3", "correct": false },
        { "text": "m < 3", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = âˆš(2x - xÂ²) nghá»‹ch biáº¿n trÃªn khoáº£ng:",
      "answers": [
        { "text": "(0; 1)", "correct": false },
        { "text": "(1; 2)", "correct": true },
        { "text": "(0; 2)", "correct": false },
        { "text": "(1; +âˆ)", "correct": false }
      ]
    },
    {
      "q": "Trong cÃ¡c hÃ m sá»‘ sau, hÃ m sá»‘ nÃ o chá»‰ cÃ³ khoáº£ng nghá»‹ch biáº¿n?",
      "answers": [
        { "text": "y = 2x + 1", "correct": false },
        { "text": "y = xÂ³ + 2x", "correct": false },
        { "text": "y = -xÂ³ - 3x", "correct": true },
        { "text": "y = xâ´ + xÂ²", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = xÂ² + 1. Kháº³ng Ä‘á»‹nh nÃ o sau Ä‘Ã¢y lÃ  Ä‘Ãºng?",
      "answers": [
        { "text": "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn (-âˆ; 0)", "correct": false },
        { "text": "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn R", "correct": true },
        { "text": "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn (1; +âˆ)", "correct": false },
        { "text": "HÃ m sá»‘ chá»‰ Ä‘á»“ng biáº¿n trÃªn (0; +âˆ)", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = (mx+4)/(x+m) nghá»‹ch biáº¿n trÃªn khoáº£ng (-âˆ; 1) khi:",
      "answers": [
        { "text": "-2 < m â‰¤ -1", "correct": false },
        { "text": "m > 2", "correct": false },
        { "text": "-1 < m < 2", "correct": true },
        { "text": "m < -2", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y = x/ln(x). Má»‡nh Ä‘á» nÃ o dÆ°á»›i Ä‘Ã¢y lÃ  sai?",
      "answers": [
        { "text": "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn (0; e)", "correct": true },
        { "text": "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn (e; +âˆ)", "correct": false },
        { "text": "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn (0; 1)", "correct": false },
        { "text": "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn (1; e)", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = (x-1)(x-2)(x-3). HÃ m sá»‘ y=f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(1; 2)", "correct": true },
        { "text": "(-âˆ; 1)", "correct": false },
        { "text": "(2; 3)", "correct": false },
        { "text": "(1; +âˆ)", "correct": false }
      ]
    },
    {
      "q": "TÃ¬m m Ä‘á»ƒ hÃ m sá»‘ y = -xÂ³ + (m-1)xÂ² - (m-1)x + 5 nghá»‹ch biáº¿n trÃªn R.",
      "answers": [
        { "text": "1 â‰¤ m â‰¤ 4", "correct": true },
        { "text": "m < 1 hoáº·c m > 4", "correct": false },
        { "text": "1 < m ", "correct": false },
        { "text": "m < 4", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ nÃ o sau Ä‘Ã¢y Ä‘á»“ng biáº¿n trÃªn khoáº£ng (0; Ï€/2)?",
      "answers": [
        { "text": "y = cos(x)", "correct": false },
        { "text": "y = cot(x)", "correct": false },
        { "text": "y = sin(x)", "correct": true },
        { "text": "y = -tan(x)", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y=f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = xÂ²(x-1)(x+2)Â³. HÃ m sá»‘ y=f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(-2; 1)", "correct": false },
        { "text": "(-âˆ; -2)", "correct": false },
        { "text": "(0; 1)", "correct": false },
        { "text": "(1; +âˆ)", "correct": true }
      ]
    },
    {
      "q": "Sá»‘ khoáº£ng Ä‘á»“ng biáº¿n cá»§a hÃ m sá»‘ y = xâ´ - 6xÂ² + 8x + 1 lÃ :",
      "answers": [
        { "text": "1", "correct": true },
        { "text": "2", "correct": false },
        { "text": "3", "correct": false },
        { "text": "0", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = sin(x) + x Ä‘á»“ng biáº¿n trÃªn:",
      "answers": [
        { "text": "(0; Ï€)", "correct": false },
        { "text": "(-Ï€/2; Ï€/2)", "correct": false },
        { "text": "R", "correct": true },
        { "text": "(-Ï€; 0)", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = x + 4/x nghá»‹ch biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(-2; 2)", "correct": false },
        { "text": "(-2; 0) vÃ  (0; 2)", "correct": true },
        { "text": "(-âˆ; -2)", "correct": false },
        { "text": "(2; +âˆ)", "correct": false }
      ]
    },
    {
      "q": "TÃ¬m táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ cá»§a m Ä‘á»ƒ hÃ m sá»‘ y = (x+m)/(x-1) Ä‘á»“ng biáº¿n trÃªn tá»«ng khoáº£ng xÃ¡c Ä‘á»‹nh.",
      "answers": [
        { "text": "m > -1", "correct": false },
        { "text": "m < -1", "correct": true },
        { "text": "m â‰¥ 1", "correct": false },
        { "text": "m â‰¤ 1", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y=f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = x(x+2)Â². HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(-âˆ; -2)", "correct": false },
        { "text": "(-2; 0)", "correct": false },
        { "text": "(0; +âˆ)", "correct": true },
        { "text": "(-âˆ; 0)", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = xÂ³ - 6xÂ² + 9x + 1 Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(1; 3)", "correct": false },
        { "text": "(-âˆ; 1)", "correct": true },
        { "text": "(-âˆ; 3)", "correct": false },
        { "text": "(1; +âˆ)", "correct": false }
      ]
    },
    {
      "q": "HÃ m sá»‘ y = -xÂ³ + 3x - 5 nghá»‹ch biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(-1; 1)", "correct": false },
        { "text": "(-âˆ; -1)", "correct": true },
        { "text": "(-âˆ; 1)", "correct": false },
        { "text": "(-âˆ; +âˆ)", "correct": false }
      ]
    },
    {
      "q": "Cho hÃ m sá»‘ y=f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = 1 - x. HÃ m sá»‘ f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o?",
      "answers": [
        { "text": "(1; +âˆ)", "correct": false },
        { "text": "(-âˆ; 1)", "correct": true },
        { "text": "(-âˆ; +âˆ)", "correct": false },
        { "text": "(-1; 1)", "correct": false }
      ]
    },
    {
      "q": "TÃ¬m m Ä‘á»ƒ hÃ m sá»‘ y = (2x+1)/(x-m) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (2; +âˆ).",
      "answers": [
        { "text": "m â‰¤ 2", "correct": false },
        { "text": "m > 2", "correct": false },
        { "text": "m < -1/2", "correct": true },
        { "text": "KhÃ´ng tá»“n táº¡i m", "correct": false }
      ]
    },
	{
      q: "Cho hÃ m sá»‘ f(x) cÃ³ xÃ¡c Ä‘á»‹nh vá»›i má»i x â‰  4 cÃ³ BBT nhÆ° hÃ¬nh dÆ°á»›i dÃ¢y, hÃ m sá»‘ Ä‘Ã£ cho Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o trong cÃ¡c khoáº£ng sao?",
      qImage: "https://i.ibb.co/SDk61TYn/image.png",
      answers: [
        { text: "(-7;+âˆ)", correct: true, image: null },
        { text: "(-7; -4)", correct: false, image: null },
        { text: "(6; +âˆ)", correct: false, image: null },
        { text: "(-7; 4)", correct: false, image: null }
      ]
    },
	{
      q: "Cho hÃ m sá»‘ y=f(x) lÃ  hÃ m sá»‘ báº­c ba cÃ³ Ä‘á»“ thá»‹ lÃ  Ä‘Æ°á»ng cong trong hÃ¬nh dÆ°á»›i Ä‘Ã¢y. HÃ m sá»‘ Ä‘Ã£ cho Ä‘á»“ng biáº¿n trÃªn khoáº£ng nÃ o dÆ°á»›i Ä‘Ã¢y?",
      qImage: "https://i.ibb.co/jvpwsqSm/image.png",
      answers: [
        { text: "(1; +âˆ)", correct: false, image: null },
        { text: "(0; 1)", correct: true, image: null },
        { text: "(-âˆ; 2)", correct: false, image: null },
        { text: "(-âˆ; 0)", correct: false, image: null }
      ]
    },
	{
      q: "Má»™t váº­t cÃ³ phÆ°Æ¡ng trÃ¬nh quÃ£ng Ä‘Æ°á»ng tÃ­nh theo thá»i gian lÃ  s(t) = 5 + 8t -2tÂ² . Táº¡i thá»i Ä‘iá»ƒm nÃ o, váº­t cÃ¡ch má»‘c tÃ­nh quÃ£ng Ä‘Æ°á»ng khoáº£ng lá»›n nháº¥t?",
      qImage: null,
      answers: [
        { text: "1 giÃ¢y", correct: false, image: null },
        { text: "2 giÃ¢y", correct: true, image: null },
        { text: "3 giÃ¢y", correct: false, image: null },
        { text: "4 giÃ¢y", correct: false, image: null }
      ]
    }
  ];

  // True/False questions [D/S]
  const trueFalseQuestions = [
    {
      q: "Cho hÃ m sá»‘ y = f(x) cÃ³ báº£ng biáº¿n thiÃªn nhÆ° hÃ¬nh váº½, xÃ©t tÃ­nh Ä‘Ãºng sai cá»§a cÃ¡c má»‡nh Ä‘á» sau:",
      qImage: "https://i.ibb.co/j9jchXzr/image.png",
      answers: [
        { text: "HÃ m sá»‘ y = f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng (-3; -2).", correct: false },
        { text: "HÃ m sá»‘ y = f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng (-1; 2).", correct: true },
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-âˆ; -2).", correct: true },
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-2; 0).", correct: false }
      ]
    },
    {
      q: "HÃ m sá»‘ y = f(x) xÃ¡c Ä‘á»‹nh, cÃ³ Ä‘áº¡o hÃ m trÃªn R vÃ  f'(x) cÃ³ Ä‘á»“ thá»‹ nhÆ° hÃ¬nh váº½ bÃªn. CÃ¡c má»‡nh Ä‘á» sau Ä‘Ãºng hay sai?",
      qImage: "https://i.ibb.co/4n5tN9CX/image.png",
	  answers: [
        { text: "HÃ m sá»‘ y = f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng (-3; -2).", correct: false },
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-âˆ; -3).", correct: false },
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-3; -2).", correct: true },
        { text: "HÃ m sá»‘ y = f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng (-2; 0).", correct: true }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = f(x) xÃ¡c Ä‘á»‹nh trÃªn R vÃ  cÃ³ báº£ng biáº¿n thiÃªn nhÆ° sau. Há»i cÃ¡c má»‡nh Ä‘á» sau Ä‘Ãºng hay sai?",
      qImage: "https://i.ibb.co/gnyzPf9/image.png",
	  answers: [
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-6; +âˆ).", correct: true },
        { text: "HÃ m sá»‘ y = f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng (-âˆ; -6).", correct: true },
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-âˆ; -2).", correct: false },
        { text: "HÃ m sá»‘ y = f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (-2; 0).", correct: true }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = (-x+2)/(x-1). CÃ¡c má»‡nh Ä‘á» sau Ä‘Ãºng hay sai?",
      answers: [
        { text: "HÃ m sá»‘ Ä‘á»“ng biáº¿n trÃªn má»—i khoáº£ng (-âˆ; 1) vÃ  (1; +âˆ).", correct: false },
        { text: "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn má»—i khoáº£ng (-âˆ; 1) vÃ  (1; +âˆ).", correct: true },
        { text: "HÃ m sá»‘ nghá»‹ch biáº¿n trÃªn R \\ {1}.", correct: false },
        { text: "HÃ m sá»‘ cÃ³ Ä‘áº¡o hÃ m y' = 1/(x-1)Â².", correct: false }
      ]
    },
    {
      q: "Cho hÃ m sá»‘ y = f(x) cÃ³ Ä‘áº¡o hÃ m f'(x) = x(x-2)Â². CÃ¡c má»‡nh Ä‘á» sau Ä‘Ãºng hay sai?",
      answers: [
        { text: "HÃ m sá»‘ f(x) Ä‘á»“ng biáº¿n trÃªn khoáº£ng (0; 2).", correct: true },
        { text: "HÃ m sá»‘ f(x) nghá»‹ch biáº¿n trÃªn khoáº£ng (-âˆ; 0).", correct: true },
        { text: "HÃ m sá»‘ f(x) Ä‘áº¡t cá»±c tiá»ƒu táº¡i x = 0.", correct: true },
        { text: "HÃ m sá»‘ f(x) cÃ³ hai Ä‘iá»ƒm cá»±c trá»‹.", correct: false }
      ]
    }
  ];

  // Essay questions [TL]
  const essayQuestions = [
    {
      q: "Äá»™ giáº£m huyáº¿t Ã¡p cá»§a má»™t bá»‡nh nhÃ¢n Ä‘Æ°á»£c cho bá»Ÿi cÃ´ng thá»©c G(x) = 0.025xÂ²(30-x), trong Ä‘Ã³ x lÃ  liá»u lÆ°á»£ng thuá»‘c Ä‘Æ°á»£c tiÃªm cho bá»‡nh nhÃ¢n (x > 0, tÃ­nh báº±ng miligam). Liá»u lÆ°á»£ng thuá»‘c cáº§n tiÃªm cho bá»‡nh nhÃ¢n náº±m trong khoáº£ng nÃ o Ä‘á»ƒ huyáº¿t Ã¡p bá»‡nh nhÃ¢n giáº£m (tá»©c lÃ  G(x) tÄƒng)?",
      qImage: null,
      answerRef: "Äá»ƒ huyáº¿t Ã¡p giáº£m, G(x) pháº£i tÄƒng. Ta cÃ³ G(x) = 0.75xÂ² - 0.025xÂ³. G'(x) = 1.5x - 0.075xÂ² = 0.075x(20 - x). G'(x) > 0 khi 0 < x < 20. Váº­y liá»u lÆ°á»£ng thuá»‘c cáº§n tiÃªm lÃ  x âˆˆ (0; 20) miligam.",
      answerRefImage: null
    },
    {
      q: "Má»™t chuyá»ƒn Ä‘á»™ng tháº³ng xÃ¡c Ä‘á»‹nh bá»Ÿi phÆ°Æ¡ng trÃ¬nh S(t) = (1/3)tÂ³ - 3tÂ² + 5t + 2 vá»›i tâ‰¥0, trong Ä‘Ã³ t tÃ­nh báº±ng giÃ¢y vÃ  S tÃ­nh báº±ng mÃ©t. Trong khoáº£ng thá»i gian nÃ o váº­n tá»‘c cá»§a váº­t tÄƒng?",
      qImage: null,
      answerRef: "Váº­n tá»‘c cá»§a váº­t lÃ  v(t) = S'(t) = tÂ² - 6t + 5. Gia tá»‘c cá»§a váº­t lÃ  a(t) = v'(t) = 2t - 6. Váº­n tá»‘c tÄƒng khi a(t) > 0, tá»©c lÃ  2t - 6 > 0, suy ra t > 3. Váº­y váº­n tá»‘c tÄƒng trong khoáº£ng (3; +âˆ) giÃ¢y.",
      answerRefImage: null
    },
    {
      q: "Má»™t cháº¥t Ä‘iá»ƒm chuyá»ƒn Ä‘á»™ng theo quy luáº­t S = -(1/3)tÂ³ + 4tÂ² + 9t vá»›i tâ‰¥0 (giÃ¢y) lÃ  khoáº£ng thá»i gian tÃ­nh tá»« lÃºc váº­t báº¯t Ä‘áº§u chuyá»ƒn Ä‘á»™ng vÃ  S (mÃ©t) lÃ  quÃ£ng Ä‘Æ°á»ng váº­t chuyá»ƒn Ä‘á»™ng trong thá»i gian Ä‘Ã³. Há»i trong khoáº£ng thá»i gian 10 giÃ¢y, ká»ƒ tá»« lÃºc báº¯t Ä‘áº§u chuyá»ƒn Ä‘á»™ng, khoáº£ng thá»i gian nÃ o váº­n tá»‘c cá»§a váº­t tÄƒng?",
      qImage: null,
      answerRef: "Váº­n tá»‘c cá»§a váº­t lÃ  v(t) = S'(t) = -tÂ² + 8t + 9. Gia tá»‘c cá»§a váº­t lÃ  a(t) = v'(t) = -2t + 8. Vá»›i t â‰¥ 0, a(t) = -2t + 8 > 0. Do Ä‘Ã³, váº­n tá»‘c cá»§a váº­t tÄƒng khi t < 4. Trong 10 giÃ¢y Ä‘áº§u, váº­n tá»‘c tÄƒng trÃªn khoáº£ng (0; 4).",
      answerRefImage: null
    },
    {
      q: "CÃ´ng suáº¥t P (Ä‘Æ¡n vá»‹ W) cá»§a má»™t máº¡ch Ä‘iá»‡n Ä‘Æ°á»£c cung cáº¥p bá»Ÿi má»™t nguá»“n pin 12V Ä‘Æ°á»£c cho bá»Ÿi cÃ´ng thá»©c P = 12I - 0.5IÂ² vá»›i I (Ä‘Æ¡n vá»‹ A) lÃ  cÆ°á»ng Ä‘á»™ dÃ²ng Ä‘iá»‡n (I > 0). Há»i cÃ´ng suáº¥t P tÄƒng trong khoáº£ng cÆ°á»ng Ä‘á»™ dÃ²ng Ä‘iá»‡n nÃ o?",
      qImage: null,
      answerRef: "Ta cÃ³ P'(I) = 12 - I. Äá»ƒ cÃ´ng suáº¥t P tÄƒng, P'(I) > 0, tá»©c lÃ  12 - I > 0, suy ra I < 12. VÃ¬ I > 0, nÃªn cÃ´ng suáº¥t tÄƒng trong khoáº£ng (0; 12) A.",
      answerRefImage: null
    },
    {
      q: "Má»™t há»£p tÃ¡c xÃ£ nuÃ´i cÃ¡ thÃ­ nghiá»‡m trong há»“. NgÆ°á»i ta tháº¥y ráº±ng náº¿u trÃªn má»—i Ä‘Æ¡n vá»‹ diá»‡n tÃ­ch cá»§a máº·t há»“ cÃ³ n con cÃ¡ (n > 0) thÃ¬ trung bÃ¬nh má»—i con cÃ¡ sau má»™t vá»¥ cÃ¢n náº·ng P(n) = 480 - 20n (gam). Há»i pháº£i tháº£ cÃ¡ trong khoáº£ng nÃ o trÃªn má»™t Ä‘Æ¡n vá»‹ diá»‡n tÃ­ch cá»§a máº·t há»“ Ä‘á»ƒ tá»•ng khá»‘i lÆ°á»£ng cÃ¡ sau má»™t vá»¥ thu Ä‘Æ°á»£c lÃ  tÄƒng?",
      qImage: null,
      answerRef: "Tá»•ng khá»‘i lÆ°á»£ng cÃ¡ lÃ  T(n) = n * P(n) = n(480 - 20n) = 480n - 20nÂ². Äá»ƒ tá»•ng khá»‘i lÆ°á»£ng tÄƒng, T'(n) > 0. Ta cÃ³ T'(n) = 480 - 40n. T'(n) > 0 â‡” 480 - 40n > 0 â‡” n < 12. Váº­y pháº£i tháº£ trong khoáº£ng (0; 12) con cÃ¡ trÃªn má»™t Ä‘Æ¡n vá»‹ diá»‡n tÃ­ch.",
      answerRefImage: null
    }
  ];

  // --- UTILITY FUNCTIONS ---
  function shuffleArray(arr) {
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function escapeHtml(unsafe) {
    return unsafe
      .replace(/</g, "â€¹")
      .replace(/>/g, "â€º")
      .replace(/"/g, "'");
  }

  // --- DOM ELEMENTS ---
  const btnMulti = document.getElementById('btn-multi');
  const btnTrueFalse = document.getElementById('btn-truefalse');
  const btnEssay = document.getElementById('btn-essay');
  const toggleThemeBtn = document.getElementById('toggle-theme');
  const btnExit = document.getElementById('btn-exit'); 
  const btnBackHomeInQuiz = document.getElementById('btn-back-home-in-quiz'); // NÃºt Back Home trong quiz
  const btnDownload = document.getElementById('btn-download');

  const quizSection = document.getElementById('quiz-section');
  const questionBlock = document.getElementById('question-block');
  const answersBlock = document.getElementById('answers-block');
  const essayInputBlock = document.getElementById('essay-input-block');
  const essayAnswerTextarea = document.getElementById('essay-answer');
  const btnEssaySubmit = document.getElementById('btn-essay-submit');
  const btnNext = document.getElementById('btn-next');

  const timerSpan = document.getElementById('timer');
  const doneCountSpan = document.getElementById('done-count');
  const correctCountSpan = document.getElementById('correct-count');
  const wrongCountSpan = document.getElementById('wrong-count');

  const resultSection = document.getElementById('result-section');
  const resultTime = document.getElementById('result-time');
  const resultTotal = document.getElementById('result-total');
  const resultCorrect = document.getElementById('result-correct');
  const resultWrong = document.getElementById('result-wrong');
  const starRating = document.getElementById('star-rating');

  // const btnRestart = document.getElementById('btn-restart'); // ÄÃ£ xÃ³a khá»i HTML, nÃªn bá» dÃ²ng nÃ y hoáº·c comment láº¡i
  const btnHome = document.getElementById('btn-home');

  // --- STATE VARIABLES ---
  let quizType = null; // 'multi', 'truefalse', 'essay'
  let questions = [];
  let currentQIdx = 0;
  let timerInterval = null;
  let timeSeconds = 0;
  let doneCount = 0;
  let correctCount = 0;
  let wrongCount = 0;
  let currentTFAnswerIdx = 0;

  // --- TIMER FUNCTIONS ---
  function startTimer() {
    timeSeconds = 0;
    timerSpan.textContent = formatTime(timeSeconds);
    if(timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeSeconds++;
      timerSpan.textContent = formatTime(timeSeconds);
    }, 1000);
  }

  function stopTimer() {
    if(timerInterval) clearInterval(timerInterval);
  }

  function formatTime(s) {
    const m = Math.floor(s/60);
    const sec = s % 60;
    return (m < 10 ? '0' + m : m) + ':' + (sec < 10 ? '0' + sec : sec);
  }

  // --- QUIZ FUNCTIONS ---
  function resetStats() {
    doneCount = 0;
    correctCount = 0;
    wrongCount = 0;
    doneCountSpan.textContent = "0";
    correctCountSpan.textContent = "0";
    wrongCountSpan.textContent = "0";
  }

  function initQuiz(type) {
    quizType = type;
    currentQIdx = 0;
    resetStats();

    if(type === 'multi') {
      questions = multiChoiceQuestions.map(q => ({
        q: q.q,
        qImage: q.qImage,
        answers: shuffleArray(q.answers.slice())
      }));
      shuffleArray(questions);
    } else if(type === 'truefalse') {
      questions = trueFalseQuestions.map(q => ({
        q: q.q,
        qImage: q.qImage,
        answers: shuffleArray(q.answers.slice())
      }));
      shuffleArray(questions);
      currentTFAnswerIdx = 0;
    } else if(type === 'essay') {
      questions = essayQuestions.map(q => ({
        q: q.q,
        qImage: q.qImage,
        answerRef: q.answerRef,
        answerRefImage: q.answerRefImage
      }));
      shuffleArray(questions);
    }
    
    quizSection.style.display = 'block';
    resultSection.style.display = 'none';
    btnMulti.style.display = 'none';
    btnTrueFalse.style.display = 'none';
    btnEssay.style.display = 'none';
    btnExit.style.display = 'none'; // áº¨n nÃºt Exit khi báº¯t Ä‘áº§u quiz
    toggleThemeBtn.style.display = 'none'; // áº¨n nÃºt chuyá»ƒn theme khi vÃ o quiz
    btnDownload.style.display = 'none';

    showQuestion();
    startTimer();
  }

  function showQuestion() {
    // áº¨n nÃºt "Tiáº¿p tá»¥c" náº¿u nÃ³ Ä‘ang hiá»ƒn thá»‹
    btnNext.style.display = 'none'; 
    // Náº¿u lÃ  dáº¡ng tá»± luáº­n, nÃºt "Xong" (submit) sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹, ngÆ°á»£c láº¡i áº©n
    btnEssaySubmit.style.display = (quizType === 'essay') ? 'block' : 'none';
    // Äáº£m báº£o nÃºt "Xong" Ä‘Æ°á»£c kÃ­ch hoáº¡t láº¡i cho cÃ¢u há»i tá»± luáº­n má»›i
    btnEssaySubmit.disabled = false; 

    answersBlock.innerHTML = ''; // XÃ³a cÃ¡c cÃ¢u tráº£ lá»i cÅ©
    essayInputBlock.style.display = 'none'; // áº¨n khung nháº­p tá»± luáº­n
    essayAnswerTextarea.value = ''; // XÃ³a ná»™i dung cÅ© trong khung tá»± luáº­n
    
    if (currentQIdx >= questions.length) {
      endQuiz();
      return;
    }

    const currentQ = questions[currentQIdx];
    
    // Display question text and image (if any)
    let questionHTML = `
      <div style="color: var(--orange); font-weight: bold; margin-bottom: 15px;">
        CÃ¢u ${currentQIdx + 1}: ${escapeHtml(currentQ.q)}
      </div>
    `;
    
    if (currentQ.qImage) {
      questionHTML += `
        <div style="text-align: center; margin: 15px 0;">
          <img src="${currentQ.qImage}" 
               style="max-width: 100%; max-height: 300px; border: 1px solid #ccc; border-radius: 5px;"
               onerror="this.style.display='none'">
        </div>
      `;
    }
    
    questionBlock.innerHTML = questionHTML;

    if (quizType === 'multi') {
      // Multiple choice questions
      answersBlock.style.display = 'block';
      currentQ.answers.forEach((ans, i) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        
        let answerContent = `${String.fromCharCode(65 + i)}. ${escapeHtml(ans.text)}`;
        
        if (ans.image) {
          answerContent += `
            <div style="margin-top: 8px; text-align: center;">
              <img src="${ans.image}" 
                   style="max-width: 100%; max-height: 150px; border: 1px solid #ddd; border-radius: 3px;"
                   onerror="this.style.display='none'">
            </div>
          `;
        }
        
        btn.innerHTML = answerContent;
        btn.onclick = () => handleMultiAnswerClick(btn, ans.correct, currentQ.answers);
        answersBlock.appendChild(btn);
      });

    } else if (quizType === 'truefalse') {
      // True/False questions
      answersBlock.style.display = 'block';
      currentTFAnswerIdx = 0;
      showTrueFalseAnswer(currentQ.answers[currentTFAnswerIdx]);
      
    } else if (quizType === 'essay') {
      // Essay questions
      essayInputBlock.style.display = 'block';
    }
  }

  function handleMultiAnswerClick(btn, isCorrect, allAnswers) {
    Array.from(answersBlock.children).forEach(b => b.classList.add('disabled'));

    doneCount++;
    doneCountSpan.textContent = doneCount;

    if(isCorrect) {
      btn.classList.add('correct');
      correctCount++;
      correctCountSpan.textContent = correctCount;
    } else {
      btn.classList.add('incorrect');
      wrongCount++;
      wrongCountSpan.textContent = wrongCount;
      // Highlight correct answer
      const correctAns = allAnswers.find(a => a.correct);
      for(let b of answersBlock.children) {
        // Cáº©n tháº­n vá»›i viá»‡c so sÃ¡nh textContent trá»±c tiáº¿p náº¿u cÃ³ hÃ¬nh áº£nh
        // Cáº§n láº¥y chá»‰ pháº§n text cá»§a cÃ¢u tráº£ lá»i
        const btnText = b.childNodes[0].nodeType === 3 ? b.childNodes[0].nodeValue.substring(3).trim() : ''; // Láº¥y text trÆ°á»›c hÃ¬nh áº£nh
        const correctText = escapeHtml(correctAns.text);

        if(btnText === correctText && correctAns.correct) {
          b.classList.add('correct');
          break;
        }
      }
    }
    btnNext.style.display = 'inline-block';
  }

  function showTrueFalseAnswer(answerObj) {
    answersBlock.innerHTML = '';

    const label = document.createElement('div');
    label.style.marginBottom = '10px';
    label.style.fontWeight = 'bold';
    label.textContent = `CÃ¢u há»i phá»¥ ${currentTFAnswerIdx + 1}: ${answerObj.text}`;
    answersBlock.appendChild(label);

    if (answerObj.image) {
      const imgDiv = document.createElement('div');
      imgDiv.style.textAlign = 'center';
      imgDiv.style.margin = '10px 0';
      imgDiv.innerHTML = `<img src="${answerObj.image}" style="max-width: 100%; max-height: 200px; border: 1px solid #ccc; border-radius: 3px;" onerror="this.style.display='none'">`;
      answersBlock.appendChild(imgDiv);
    }

    const btnTrue = document.createElement('button');
    btnTrue.className = 'answer-btn';
    btnTrue.textContent = 'ÄÃºng';
    btnTrue.onclick = () => handleTrueFalseAnswerClick(true, answerObj.correct);
    answersBlock.appendChild(btnTrue);
    
    const btnFalse = document.createElement('button');
    btnFalse.className = 'answer-btn';
    btnFalse.textContent = 'Sai';
    btnFalse.onclick = () => handleTrueFalseAnswerClick(false, answerObj.correct);
    answersBlock.appendChild(btnFalse);
  }

  function handleTrueFalseAnswerClick(userAnswer, correctAnswer) {
    Array.from(answersBlock.querySelectorAll('button')).forEach(b => b.classList.add('disabled'));

    doneCount++;
    doneCountSpan.textContent = doneCount;

    if(userAnswer === correctAnswer) {
      correctCount++;
      correctCountSpan.textContent = correctCount;
      Array.from(answersBlock.querySelectorAll('button')).forEach(b => {
        if(b.textContent.toLowerCase() === (userAnswer ? 'Ä‘Ãºng' : 'sai')) {
          b.classList.add('correct');
        }
      });
    } else {
      wrongCount++;
      wrongCountSpan.textContent = wrongCount;
      Array.from(answersBlock.querySelectorAll('button')).forEach(b => {
        if(b.textContent.toLowerCase() === (userAnswer ? 'Ä‘Ãºng' : 'sai')) {
          b.classList.add('incorrect');
        }
        if(b.textContent.toLowerCase() === (correctAnswer ? 'Ä‘Ãºng' : 'sai')) {
          b.classList.add('correct');
        }
      });
    }

    btnNext.style.display = 'inline-block';
  }

  // Essay submit handler
  btnEssaySubmit.onclick = () => {
    const userText = essayAnswerTextarea.value.trim();
    if(userText.length === 0) {
      alert('HÃ£y nháº­p cÃ¢u tráº£ lá»i trÆ°á»›c khi nháº¥n "Xong"');
      return;
    }
    btnEssaySubmit.disabled = true; // VÃ´ hiá»‡u hÃ³a nÃºt "Xong" sau khi submit
    
    doneCount++;
    doneCountSpan.textContent = doneCount;

    const currentQ = questions[currentQIdx];
    let answerRefHTML = `<br><br><em><strong>ÄÃ¡p Ã¡n tham kháº£o:</strong> ${currentQ.answerRef}</em>`;
    
    if(currentQ.answerRefImage) {
      answerRefHTML += `<div style="margin: 15px 0; text-align: center;">
        <img src="${currentQ.answerRefImage}" style="max-width: 100%; max-height: 300px; border: 1px solid #ccc; border-radius: 5px;">
      </div>`;
    }
    
    questionBlock.innerHTML += answerRefHTML;
    btnNext.style.display = 'inline-block';
  };

  btnNext.onclick = () => {
    // áº¨n nÃºt "Tiáº¿p tá»¥c"
    btnNext.style.display = 'none';
    // Äáº£m báº£o nÃºt "Xong" (essay) Ä‘Æ°á»£c kÃ­ch hoáº¡t láº¡i
    btnEssaySubmit.disabled = false; 

    if(quizType === 'truefalse') {
      currentTFAnswerIdx++;
      const currentQ = questions[currentQIdx];
      // Náº¿u cÃ²n cÃ¢u há»i phá»¥ trong cÃ¢u há»i ÄÃºng/Sai hiá»‡n táº¡i
      if(currentTFAnswerIdx < currentQ.answers.length) {
        showTrueFalseAnswer(currentQ.answers[currentTFAnswerIdx]);
        return; // KhÃ´ng chuyá»ƒn sang cÃ¢u há»i tiáº¿p theo mÃ  hiá»ƒn thá»‹ cÃ¢u phá»¥
      }
    }

    // Chuyá»ƒn sang cÃ¢u há»i tiáº¿p theo
    currentQIdx++;
    showQuestion();
  };

  function endQuiz() {
    stopTimer();
    quizSection.style.display = 'none';
    resultSection.style.display = 'block';
    toggleThemeBtn.style.display = 'block'; // Hiá»ƒn thá»‹ láº¡i nÃºt chuyá»ƒn theme

    resultTime.textContent = formatTime(timeSeconds);
    resultTotal.textContent = doneCount;
    resultCorrect.textContent = correctCount;
    resultWrong.textContent = wrongCount;

    starRating.innerHTML = '';

    // Logic tÃ­nh sao Ä‘Ã£ Ä‘Æ°á»£c khÃ´i phá»¥c vÃ  tinh chá»‰nh
    if(quizType === 'multi' || quizType === 'truefalse') {
      let starsGreen = 0;
      let starsGray = 0;
      
      if(wrongCount === 0) { // Náº¿u khÃ´ng cÃ³ cÃ¢u sai
        starsGreen = 3; // 3 sao xanh
      } else if (wrongCount >= 1 && wrongCount <= 3) {
        starsGreen = 2; // 2 sao xanh
        starsGray = 1; // 1 sao xÃ¡m
      } else if (wrongCount >= 4 && wrongCount <= 9) {
        starsGreen = 1; // 1 sao xanh
        starsGray = 2; // 2 sao xÃ¡m
      } else { // wrongCount >= 10
        starsGreen = 0; // 0 sao xanh
        starsGray = 3; // 3 sao xÃ¡m
      }

      for(let i = 1; i <= 3; i++) {
        const star = document.createElement('span');
        star.classList.add('star');
        if(i <= starsGreen) star.classList.add('Green');
        else if(i <= starsGray) star.classList.add('gray');
        star.innerHTML = '&#9733;';
        starRating.appendChild(star);
      }
    } else if (quizType === 'essay') {
        // Äá»‘i vá»›i bÃ i tá»± luáº­n, khÃ´ng cÃ³ Ä‘iá»ƒm Ä‘Ãºng/sai tá»± Ä‘á»™ng
        // Báº¡n cÃ³ thá»ƒ thÃªm logic cháº¥m Ä‘iá»ƒm thá»§ cÃ´ng hoáº·c hiá»ƒn thá»‹ thÃ´ng bÃ¡o khÃ¡c
        const infoDiv = document.createElement('div');
        infoDiv.textContent = "BÃ i Tá»± Luáº­n Cáº§n ÄÆ°á»£c GiÃ¡o ViÃªn Cháº¥m Äiá»ƒm.";
        infoDiv.style.fontWeight = "bold";
        infoDiv.style.marginTop = "20px";
        starRating.appendChild(infoDiv);
    }
  }

  // --- EVENT LISTENERS ---
  // ÄÃ£ xÃ³a btnRestart.onclick vÃ  logic liÃªn quan
  // Náº¿u báº¡n muá»‘n chá»©c nÄƒng "lÃ m láº¡i" bÃ i quiz, báº¡n cáº§n táº¡o má»™t nÃºt má»›i vá»›i ID khÃ¡c
  // vÃ  thÃªm láº¡i logic reset Stats vÃ o event listener cá»§a nÃºt Ä‘Ã³.

  // NÃºt Home (á»Ÿ mÃ n hÃ¬nh káº¿t quáº£) - váº«n reload trang hiá»‡n táº¡i
  btnHome.onclick = () => {
    location.reload(); 
  };

  btnMulti.onclick = () => initQuiz('multi');
  btnTrueFalse.onclick = () => initQuiz('truefalse');
  btnEssay.onclick = () => initQuiz('essay');
  // New: Download button functionality
  btnDownload.onclick = () => {
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'toancreator-default'; // Set the desired filename
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(a.href);
  };
  
  
  // Xá»­ lÃ½ sá»± kiá»‡n cho nÃºt Exit má»›i
  btnExit.onclick = () => {
    window.location.href = '../index.html'; // Chuyá»ƒn hÆ°á»›ng vá» index.html
  };

  // Xá»­ lÃ½ sá»± kiá»‡n cho nÃºt Back to Home trong quiz
  btnBackHomeInQuiz.onclick = () => {
    if (confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n thoÃ¡t bÃ i lÃ m hiá»‡n táº¡i?')) {
      stopTimer(); // Dá»«ng Ä‘á»“ng há»“
      location.reload(); // Táº£i láº¡i trang promt-onlineV2.html
    }
  };

  toggleThemeBtn.onclick = () => {
    document.body.classList.toggle('dark');
  };

  // áº¨n/hiá»‡n nÃºt toggle theme ban Ä‘áº§u
  // Báº¡n cÃ³ thá»ƒ Ä‘áº·t nÃºt toggle theme á»Ÿ vá»‹ trÃ­ cá»‘ Ä‘á»‹nh thay vÃ¬ áº©n/hiá»‡n tÃ¹y thuá»™c vÃ o mÃ n hÃ¬nh
  // Hiá»‡n táº¡i, nÃ³ sáº½ luÃ´n hiá»ƒn thá»‹ trá»« khi bá»‹ áº©n bá»Ÿi CSS hoáº·c logic khÃ¡c
  toggleThemeBtn.style.display = 'block'; 
})();
</script>
</body>
</html>